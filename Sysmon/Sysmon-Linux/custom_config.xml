<!-- custom config take precaution -->

<Sysmon schemaversion="4.81">
  <EventFiltering>

    <RuleGroup name="ProcessCreateRules" groupRelation="or">

      <ProcessCreate onmatch="exclude">
        <Image condition="contains">splunkd</Image>
        <CommandLine condition="contains">/opt/splunkforwarder</CommandLine>
        <Image condition="contains">mintUpdate</Image>
        <Image condition="contains">cinnamon</Image>
        <Image condition="end with">/vmtoolsd</Image>
        <CommandLine condition="contains">dbus-daemon</CommandLine>
        <CommandLine condition="contains">apt.systemd.daily</CommandLine>
        <CommandLine condition="contains">run-parts</CommandLine>
        <Image condition="end with">/usr/bin/sysmon</Image>
      </ProcessCreate>

      <ProcessCreate onmatch="include">

        <Rule name="T1059.004: Unix Shell" groupRelation="or">
          <Image condition="end with">/bin/bash</Image>
          <Image condition="end with">/bin/sh</Image>
          <Image condition="end with">/bin/dash</Image>
        </Rule>

        <Rule name="T1105: Ingress Tool Transfer" groupRelation="or">
          <Image condition="end with">wget</Image>
          <Image condition="end with">curl</Image>
          <Image condition="end with">scp</Image>
          <Image condition="end with">ftp</Image>
          <Image condition="end with">tftp</Image>
        </Rule>

        <Rule name="T1003: Credential Dumping Tools" groupRelation="or">
            <Image condition="end with">mimipenguin</Image>
            <Image condition="end with">gdb</Image> </Rule>

        <Rule name="T1059: Interpreters and Compilers">
             <Image condition="end with">python</Image>
             <Image condition="end with">python3</Image>
             <Image condition="end with">perl</Image>
             <Image condition="end with">gcc</Image>
             <Image condition="end with">g++</Image>
             <Image condition="end with">make</Image>
        </Rule>

        <Rule name="T1033: User Discovery">
          <CommandLine condition="contains">whoami</CommandLine>
          <CommandLine condition="contains">id</CommandLine>
          <CommandLine condition="contains">cat /etc/passwd</CommandLine>
        </Rule>

        <Rule name="T1070: Indicator Removal on Host">
            <CommandLine condition="contains">rm -rf</CommandLine>
            <CommandLine condition="contains">shred</CommandLine>
            <CommandLine condition="contains">history -c</CommandLine>
        </Rule>
      </ProcessCreate>
    </RuleGroup>

    <RuleGroup name="NetworkConnectRules" groupRelation="or">
      <NetworkConnect onmatch="include">

        <Rule name="T1059: Suspicious Shell Connection" groupRelation="or">
          <Image condition="end with">/bin/bash</Image>
          <Image condition="end with">/bin/sh</Image>
          <Image condition="end with">/bin/dash</Image>
          <Image condition="contains">python</Image>
          <Image condition="contains">perl</Image>
        </Rule>

        <Rule name="T1105: Ingress Tool Transfer" groupRelation="or">
          <Image condition="end with">wget</Image>
          <Image condition="end with">ssh</Image>
          <Image condition="end with">curl</Image>
          <Image condition="end with">nc</Image>
          <Image condition="end with">ncat</Image>
          <Image condition="end with">netcat</Image>
          <Image condition="end with">socat</Image>
        </Rule>
      </NetworkConnect>
    </RuleGroup>

    <RuleGroup name="FileCreateRules" groupRelation="or">
      <FileCreate onmatch="include">

        <Rule name="T1053.003: Scheduled Task - Cron">
          <TargetFilename condition="begin with">/etc/cron</TargetFilename>
        </Rule>

        <Rule name="T1098.004: SSH Persistence">
           <TargetFilename condition="end with">authorized_keys</TargetFilename>
        </Rule>

        <Rule name="T1548: Sudoers/Group Mod">
           <TargetFilename condition="begin with">/etc/sudoers</TargetFilename>
           <TargetFilename condition="begin with">/etc/group</TargetFilename>
        </Rule>

      </FileCreate>
    </RuleGroup>

  </EventFiltering>
</Sysmon>
